---
import ImageMod from "@/components/ImageMod.astro";
import IconMapper from "@/components/IconMapper.astro";

interface RelatedProduct {
  id: string;
  data: {
    title: string;
    description?: string;
    image?: string;
    icon?: string;
  };
}

interface Props {
  products: RelatedProduct[];
}

const { products } = Astro.props;

// System-spezifische Daten (gleiche wie in index.astro)
const systemData: Record<
  string,
  {
    badge: string;
    price: string;
    color: string;
    bgColor: string;
    textColor: string;
    shortDescription: string;
    features: Record<string, { label: string; rating: number }>;
    idealFor: string[];
    highlights: string[];
  }
> = {
  chip: {
    badge: "Preis-Leistungs-Sieger",
    price: "ab 579",
    color: "from-emerald-500 to-teal-600",
    bgColor: "bg-emerald-50",
    textColor: "text-emerald-600",
    shortDescription:
      "Schnell, hygienisch und kontaktlos. Jeder Mitarbeiter erhaelt einen persoenlichen Chip.",
    features: {
      kosten: { label: "Niedrig", rating: 3 },
      bedienung: { label: "Sehr einfach", rating: 3 },
      sicherheit: { label: "Hoch", rating: 2 },
      hygiene: { label: "Mit Kontakt", rating: 1 },
    },
    idealFor: ["Kleinbetriebe", "Handwerk", "Einzelhandel"],
    highlights: [
      "Guenstigste Option",
      "Einfache Bedienung",
      "Schnelle Einrichtung",
    ],
  },
  fingerabdruck: {
    badge: "Sicherheits-Sieger",
    price: "ab 659",
    color: "from-blue-500 to-indigo-600",
    bgColor: "bg-blue-50",
    textColor: "text-blue-600",
    shortDescription:
      "Biometrische Zeiterfassung mit hoechster Sicherheit und Manipulationssicherheit.",
    features: {
      kosten: { label: "Mittel", rating: 2 },
      bedienung: { label: "Einfach", rating: 2 },
      sicherheit: { label: "Sehr hoch", rating: 3 },
      hygiene: { label: "Mit Kontakt", rating: 1 },
    },
    idealFor: ["Mittelstand", "Sicherheitsbereiche", "Produktion"],
    highlights: [
      "Biometrische Sicherheit",
      "Kein Chip verlierbar",
      "Manipulationssicher",
    ],
  },
  gesichtserkennung: {
    badge: "Hygiene-Sieger",
    price: "ab 624",
    color: "from-purple-500 to-pink-600",
    bgColor: "bg-purple-50",
    textColor: "text-purple-600",
    shortDescription:
      "KI-basierte Zeiterfassung - beruehrungslos, schnell und benutzerfreundlich.",
    features: {
      kosten: { label: "Hoeher", rating: 1 },
      bedienung: { label: "Sehr einfach", rating: 3 },
      sicherheit: { label: "Sehr hoch", rating: 3 },
      hygiene: { label: "Kontaktlos", rating: 3 },
    },
    idealFor: ["Gastronomie", "Gesundheitswesen", "Lebensmittel"],
    highlights: [
      "100% kontaktlos",
      "Schnellste Erfassung",
      "Modernste Technologie",
    ],
  },
};
---

{
  products && products.length > 0 && (
    <section class="section bg-tertiary">
      <div class="container">
        <div class="row mb-8">
          <div class="col-12 text-center">
            <h2 class="h3 mb-2" data-aos="fade-up-sm">
              Weitere Zeiterfassungssysteme
            </h2>
            <p
              class="text-text-dark"
              data-aos="fade-up-sm"
              data-aos-delay="100"
            >
              Entdecken Sie auch unsere anderen Zeiterfassungsloesungen
            </p>
          </div>
        </div>

        <div class="row gy-6 justify-center">
          {products.map((product, index) => {
            const { title, image, icon } = product.data;
            const systemId = product.id;
            const system = systemData[systemId] || systemData.chip;
            const displayIcon = icon || "chip";

            return (
              <div
                class="col-12 lg:col-4"
                data-aos="fade-up-sm"
                data-aos-delay={index * 100}
              >
                <div class="relative h-full rounded-3xl overflow-hidden bg-body shadow-lg hover:shadow-2xl transition-all duration-300">
                  {/* Badge */}
                  <div
                    class={`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-bold text-white bg-gradient-to-r ${system.color} z-10`}
                  >
                    {system.badge}
                  </div>

                  {/* Product Image */}
                  <div
                    class={`${system.bgColor} p-6 flex items-center justify-center`}
                  >
                    {image ? (
                      <ImageMod
                        src={image}
                        alt={title}
                        width={200}
                        height={200}
                        format="webp"
                        class="object-contain h-[180px] w-auto"
                      />
                    ) : (
                      <div class={system.textColor}>
                        <IconMapper
                          icon={displayIcon}
                          size="5rem"
                          ariaHidden={true}
                        />
                      </div>
                    )}
                  </div>

                  {/* Header */}
                  <div class="p-6 pb-0">
                    <div class="flex items-center gap-3 mb-3">
                      <div
                        class={`w-12 h-12 rounded-xl ${system.bgColor} flex items-center justify-center`}
                      >
                        <IconMapper
                          icon={displayIcon}
                          size="1.5rem"
                          className={system.textColor}
                          ariaLabel={title}
                        />
                      </div>
                      <div>
                        <h3 class="h4 mb-0">{title}</h3>
                        <div class="flex items-baseline gap-1">
                          <span class={`text-xl font-bold ${system.textColor}`}>
                            {system.price}
                          </span>
                          <span class="text-text-dark text-xs">EUR</span>
                        </div>
                      </div>
                    </div>
                    <p class="text-sm text-text-dark mb-4">
                      {system.shortDescription}
                    </p>
                  </div>

                  {/* CTA */}
                  <div class="p-6 pt-2">
                    <a
                      href={`/zeiterfassungssysteme/${product.id}`}
                      class={`btn w-full flex items-center justify-center gap-2 text-white bg-gradient-to-r ${system.color} hover:opacity-90 transition-opacity`}
                    >
                      Details ansehen
                      <IconMapper icon="arrow" size="1rem" ariaHidden={true} />
                    </a>
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>
    </section>
  )
}
