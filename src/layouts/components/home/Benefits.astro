---
import { markdownify } from "@/lib/utils/textConverter";
import ImageMod from "../ImageMod.astro";
import {
  FaWifi,
  FaMobileScreen,
  FaDesktop,
  FaCalendarXmark,
  FaEnvelope,
  FaFileLines,
  FaDatabase,
  FaImage,
  FaChartLine,
  FaShield,
  FaVideo,
  FaEuroSign,
  FaPencil,
} from "react-icons/fa6";

const { benefits } = Astro.props;

// Icon mapping
const iconMap: Record<string, any> = {
  FaWifi,
  FaMobileScreen,
  FaDesktop,
  FaCalendarXmark,
  FaEnvelope,
  FaFileLines,
  FaDatabase,
  FaImage,
  FaChartLine,
  FaShield,
  FaVideo,
  FaEuroSign,
  FaPencil,
};

// Distribute items across 3 columns dynamically
const points = benefits.points || [];
const leftColumn: any[] = [];
const middleColumn: any[] = [];
const rightColumn: any[] = [];

points.forEach((point: any, i: number) => {
  const columnIndex = i % 3;
  if (columnIndex === 0) leftColumn.push(point);
  else if (columnIndex === 1) middleColumn.push(point);
  else rightColumn.push(point);
});

// Helper to render a benefit card
const renderCard = (point: any, isMiddle = false) => ({
  point,
  isMiddle,
});
---

<section class="section bg-primary">
  <div class="container">
    <div class="row justify-center">
      <div class="sm:col-8 text-center">
        <p
          set:html={markdownify(benefits.subtitle)}
          class="mb-4 text-sm text-light/70"
          data-aos="fade-up-sm"
        />
        <h2
          set:html={markdownify(benefits.title)}
          class="mb-8 md:mb-[7.5rem] lg:h1 text-light"
          data-aos="fade-up-sm"
          data-aos-delay="100"
        />
      </div>
      <div class="col-12">
        <div
          class="flex flex-wrap lg:flex-nowrap gap-6 justify-center w-full"
          data-aos="fade-up-sm"
          data-aos-delay="200"
        >
          <!-- left column -->
          <div
            class="w-full lg:w-1/3 min-h-full flex flex-col md:flex-row lg:flex-col gap-6"
          >
            {
              leftColumn.map((point: any, i: number) => {
                const IconComponent = point.icon ? iconMap[point.icon] : null;
                return (
                  <div
                    class="rounded-2xl overflow-hidden flex flex-col"
                    data-aos="zoom-in-sm"
                    data-aos-delay={`${i * 100}`}
                  >
                    <div class="bg-light/15 max-lg:pt-4 max-lg:pb-8 grow relative grid place-items-center py-12">
                      {point.icon && IconComponent ? (
                        <div class="text-light/90">
                          <IconComponent size="2.5rem" />
                        </div>
                      ) : point.image ? (
                        <div class="blurryDivBg w-[70%] rounded-2xl z-10">
                          <ImageMod
                            src={point.image}
                            alt={point.title}
                            width={364}
                            height={300}
                          />
                        </div>
                      ) : null}
                    </div>
                    <div class="p-6 bg-light/10 mt-auto">
                      <p class="text-xl mb-2 text-light">{point.title}</p>
                      <p class="text-light/70">{point.content}</p>
                    </div>
                  </div>
                );
              })
            }
          </div>

          <!-- middle column -->
          <div
            class="w-full lg:w-1/3 min-h-full flex flex-col md:flex-row lg:flex-col gap-6"
          >
            {
              middleColumn.map((point: any, i: number) => {
                const IconComponent = point.icon ? iconMap[point.icon] : null;
                return (
                  <div class="rounded-2xl overflow-hidden flex flex-col">
                    <div class="bg-light/15 max-lg:pt-4 max-lg:pb-8 grow relative grid place-items-center py-12">
                      {point.icon && IconComponent ? (
                        <div class="text-light/90">
                          <IconComponent size="2.5rem" />
                        </div>
                      ) : point.image ? (
                        <ImageMod
                          src={point.image}
                          alt={point.title}
                          width={392}
                          height={middleColumn.length === 1 ? 644 : 300}
                          class="w-full"
                        />
                      ) : null}
                    </div>
                    <div class="p-6 bg-light/10 mt-auto">
                      <p class="text-xl mb-2 text-light">{point.title}</p>
                      <p class="text-light/70">{point.content}</p>
                    </div>
                  </div>
                );
              })
            }
          </div>

          <!-- right column -->
          <div
            class="w-full lg:w-1/3 min-h-full flex flex-col md:flex-row lg:flex-col gap-6"
          >
            {
              rightColumn.map((point: any, i: number) => {
                const IconComponent = point.icon ? iconMap[point.icon] : null;
                return (
                  <div
                    class="rounded-2xl overflow-hidden flex flex-col"
                    data-aos="zoom-in-sm"
                    data-aos-delay={`${i * 100}`}
                  >
                    <div class="bg-light/15 max-lg:pt-4 max-lg:pb-8 grow relative grid place-items-center py-12">
                      {point.icon && IconComponent ? (
                        <div class="text-light/90">
                          <IconComponent size="2.5rem" />
                        </div>
                      ) : point.image ? (
                        <div class="blurryDivBg w-[70%] rounded-2xl z-10">
                          <ImageMod
                            src={point.image}
                            alt={point.title}
                            width={364}
                            height={300}
                          />
                        </div>
                      ) : null}
                    </div>
                    <div class="p-6 bg-light/10 mt-auto">
                      <p class="text-xl mb-2 text-light">{point.title}</p>
                      <p class="text-light/70">{point.content}</p>
                    </div>
                  </div>
                );
              })
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
