---
import Benefits from "@/components/home/Benefits.astro";
import Features from "@/components/home/Features.astro";
import Hero from "@/components/home/Hero.astro";
import Offering from "@/components/home/Offering.astro";
import Plans from "@/components/home/Plans.astro";
import UspFeatures from "@/components/home/UspFeatures.astro";
import Base from "@/layouts/Base.astro";
import { getListPage } from "@/lib/contentParser.astro";
import { getCollection, getEntry } from "astro:content";
import CallToAction from "@/partials/CallToAction.astro";
import Testimonial from "@/partials/Testimonial.astro";

const homepage = await getListPage("homepage", "new-home");
const { hero, usps, feature, offering, benefits, plan } = homepage.data;

// Load additional sections
const videoTestimonial = await getEntry("sections", "video-testimonial");
const homeTestimonials = await getEntry("sections", "home-testimonials");
const fragebogenCta = await getEntry("sections", "fragebogen-cta");

// Load FAQ collection
const faqEntries = await getCollection("faq");
const zeiterfassungFaq = faqEntries.find(
  (entry) => entry.id === "zeiterfassung.md",
);
---

<Base>
  <Hero {hero} />
  <UspFeatures {usps} />
  <Features {feature} />
  <Offering {offering} />
  <Benefits {benefits} />
  <!-- Video Testimonial Section -->
  {
    videoTestimonial && videoTestimonial.data && (
      <section class="section">
        <div class="container">
          <div class="row justify-center text-center">
            <div class="lg:col-8">
              <h2 class="mb-8">{videoTestimonial.data.title}</h2>
              <video controls class="w-full rounded-xl">
                <source
                  src={videoTestimonial.data.video_url}
                  type="video/mp4"
                />
              </video>
              {videoTestimonial.data.testimonial && (
                <>
                  <p class="mt-4 text-lg font-semibold">
                    {videoTestimonial.data.testimonial.name}
                  </p>
                  <p class="text-light">
                    {videoTestimonial.data.testimonial.designation} Â·{" "}
                    {videoTestimonial.data.testimonial.company}
                  </p>
                </>
              )}
            </div>
          </div>
        </div>
      </section>
    )
  }
  <!-- Google Reviews -->
  {
    homeTestimonials && homeTestimonials.data.reviews && (
      <Testimonial testimonials={homeTestimonials.data.reviews} />
    )
  }
  <!-- Fragebogen CTA -->
  {
    fragebogenCta && (
      <section class="section bg-theme-light">
        <div class="container">
          <div class="row justify-center text-center">
            <div class="lg:col-10">
              <h2 class="mb-4">{fragebogenCta.data.title}</h2>
              <p class="mb-8 text-lg">{fragebogenCta.data.description}</p>
              {fragebogenCta.data.youtube_embed && (
                <div class="mb-8 aspect-video">
                  <iframe
                    src={fragebogenCta.data.youtube_embed}
                    class="h-full w-full rounded-xl"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen
                  />
                </div>
              )}
              {fragebogenCta.data.button?.enable && (
                <a
                  href={fragebogenCta.data.button.link}
                  class="btn btn-primary"
                >
                  {fragebogenCta.data.button.label}
                </a>
              )}
            </div>
          </div>
        </div>
      </section>
    )
  }
  <!-- FAQ Section -->
  {
    zeiterfassungFaq && (
      <section class="section">
        <div class="container">
          <div class="row justify-center">
            <div class="lg:col-10">
              <h2 class="mb-8 text-center">{zeiterfassungFaq.data.title}</h2>
              <div class="space-y-4">
                {zeiterfassungFaq.data.faqs.map((faq) => (
                  <details class="rounded-lg border border-border p-6">
                    <summary class="cursor-pointer text-lg font-semibold">
                      {faq.question}
                    </summary>
                    <p class="mt-4 text-light">{faq.answer}</p>
                  </details>
                ))}
              </div>
            </div>
          </div>
        </div>
      </section>
    )
  }
  <CallToAction />
</Base>
